<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Rooms</title>
  <script>
    async function loadPageWithToken() {
      try {
        // /api/chatrooms 엔드포인트를 사용해 데이터를 가져옴
        const response = await fetch("/api/chatlist", {
          method: "GET",
        });

        if (response.ok) {
          const chatRooms = await response.json();

          // 채팅방 리스트 동적으로 렌더링
          const chatListContainer = document.getElementById("chat-rooms");
          chatListContainer.innerHTML = ""; // 기존 내용 제거

          chatRooms.forEach((room) => {
            const roomElement = document.createElement("li");
            roomElement.textContent = `방 이름: ${room.name}, 인원: ${room.memberCount}`;
            roomElement.onclick = () => enterChatRoom(room.id);
            chatListContainer.appendChild(roomElement);
          });
        } else if (response.status === 401) {
          alert("Unauthorized. Redirecting to login.");
          window.location.href = "/login";
        } else {
          alert("Failed to load chat rooms.");
        }
      } catch (error) {
        console.error("Error loading chat rooms:", error);
        alert("An error occurred while loading chat rooms.");
      }
    }


    async function enterChatRoom(roomId) {
      // 특정 채팅방으로 이동
      window.location.href = `/chat/${roomId}`;
    }

    // 페이지 로드 시 실행
    window.onload = loadPageWithToken;
  </script>
</head>
<body>
<h2>Chat Rooms</h2>
<ul id="chat-rooms">
  <li>Loading chat rooms...</li>
</ul>
<button onclick="openCreateRoomModal()">Create New Chat Room</button>

<div id="createRoomModal" style="display: none;">
  <h3>Select Users to Invite</h3>
  <ul id="user-list"></ul>
  <button onclick="createChatRoom()">Create Room</button>
</div>

</body>
</html>
