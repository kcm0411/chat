<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat Rooms</title>
  <script>
    async function loadChatRooms() {
      const accessToken = sessionStorage.getItem("accessToken"); // 세션 스토리지에서 Access Token 가져오기

      if (!accessToken) {
        alert("Access Token is missing. Redirecting to login page.");
        window.location.href = "/login";
        return;
      }

      try {
        // 서버에서 채팅방 목록 가져오기
        const response = await fetch("/chat", {
          method: "GET",
          headers: {
            "Authorization": "Bearer " + accessToken,
          },
        });

        if (response.ok) {
          const chatRooms = await response.json();

          // 채팅방 리스트 동적으로 렌더링
          const chatListContainer = document.getElementById("chat-rooms");
          chatListContainer.innerHTML = ""; // 기존 내용 제거

          chatRooms.forEach((room) => {
            const roomElement = document.createElement("li");
            roomElement.textContent = `방 이름: ${room.name}, 인원: ${room.memberCount}, 마지막 메시지: ${room.lastMessage}`;
            roomElement.onclick = () => enterChatRoom(room.id);
            chatListContainer.appendChild(roomElement);
          });
        } else if (response.status === 401) {
          alert("Unauthorized. Redirecting to login.");
          window.location.href = "/login";
        } else {
          alert("Failed to fetch chat rooms.");
        }
      } catch (error) {
        console.error("Error fetching chat rooms:", error);
        alert("An error occurred while fetching chat rooms.");
      }
    }

    async function enterChatRoom(roomId) {
      // 특정 채팅방으로 이동
      window.location.href = `/chat/${roomId}`;
    }

    window.onload = loadChatRooms; // 페이지 로드 시 채팅방 목록 가져오기
  </script>
</head>
<body>
<h2>Chat Rooms</h2>
<ul id="chat-rooms">
  <li>Loading chat rooms...</li>
</ul>
<button onclick="window.location.href='/create-room'">Create New Chat Room</button>
</body>
</html>
